# bTube æŠ€æœ¯æ¶æ„æ–‡æ¡£

> åŸºäº bili_tube çš„æŠ€æœ¯æ¶æ„åˆ†æä¸è®¾è®¡

---

## ğŸ“ æ•´ä½“æ¶æ„

### æ¶æ„æ¨¡å¼
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Presentation Layer                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Screen     â”‚  â”‚   ViewModel  â”‚  â”‚   UIState    â”‚  â”‚
â”‚  â”‚  (Compose)   â”‚â†â†’â”‚   (Logic)    â”‚â†â†’â”‚   (Data)     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Domain Layer                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Repository  â”‚  â”‚  Use Cases   â”‚  â”‚    Models    â”‚  â”‚
â”‚  â”‚   (Data)     â”‚  â”‚  (Business)  â”‚  â”‚   (Entity)   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Data Layer                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Remote API  â”‚  â”‚ Local Cache  â”‚  â”‚  Paging      â”‚  â”‚
â”‚  â”‚   (Ktor)     â”‚  â”‚ (Room/DS)    â”‚  â”‚  (Paging3)   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ¨¡å—ä¾èµ–å…³ç³»
```
app
 â”œâ”€â”€ bili_sdk (Bç«™APIå’Œæ•°æ®æ¨¡å‹)
 â”œâ”€â”€ common_ui_core (é€šç”¨UIç»„ä»¶)
 â””â”€â”€ feature_annotations (ç‰¹æ€§æ³¨è§£)
```

---

## ğŸ”§ æŠ€æœ¯æ ˆè¯¦è§£

### 1. UIå±‚æŠ€æœ¯

#### Jetpack Compose
- **ç‰ˆæœ¬**: 2025.10.00 (BOM)
- **ç”¨é€”**: å£°æ˜å¼UIæ¡†æ¶
- **æ ¸å¿ƒç»„ä»¶**:
  - `@Composable` å‡½æ•°
  - `remember` / `mutableStateOf` çŠ¶æ€ç®¡ç†
  - `LaunchedEffect` / `DisposableEffect` å‰¯ä½œç”¨å¤„ç†
  - Material 3 ç»„ä»¶åº“

#### Material 3
- **è®¾è®¡ç³»ç»Ÿ**: Material Design 3
- **ä¸»é¢˜**: æ”¯æŒäº®è‰²/æš—è‰²ä¸»é¢˜
- **ç»„ä»¶**: 
  - NavigationBar - åº•éƒ¨å¯¼èˆª
  - TopAppBar - é¡¶éƒ¨å¯¼èˆª
  - Card - å¡ç‰‡å®¹å™¨
  - Button - æŒ‰é’®ç»„ä»¶
  - TextField - è¾“å…¥æ¡†
  - Dialog - å¯¹è¯æ¡†

#### Adaptive Layout
- **ç”¨é€”**: è‡ªé€‚åº”å¸ƒå±€ï¼Œæ”¯æŒæ‰‹æœº/å¹³æ¿/æŠ˜å å±
- **ç»„ä»¶**: 
  - `NavigationSuiteScaffold` - è‡ªé€‚åº”å¯¼èˆªè„šæ‰‹æ¶
  - `ListDetailPaneScaffold` - åˆ—è¡¨è¯¦æƒ…å¸ƒå±€

#### Lottie
- **ç‰ˆæœ¬**: 6.6.10
- **ç”¨é€”**: åŠ¨ç”»æ’­æ”¾
- **åº”ç”¨åœºæ™¯**: å¯åŠ¨é¡µã€åŠ è½½åŠ¨ç”»ã€ç©ºçŠ¶æ€å±•ç¤º

---

### 2. æ¶æ„å±‚æŠ€æœ¯

#### MVVMæ¶æ„
```kotlin
// ViewModel å±‚
class HomeViewModel(
    private val repository: BiliHomeRepository
) : ViewModel() {
    val uiState: StateFlow<HomeUIState> = ...
    
    fun loadData() { ... }
}

// UI å±‚
@Composable
fun HomeScreen(
    viewModel: HomeViewModel = koinViewModel()
) {
    val uiState by viewModel.uiState.collectAsStateWithLifecycle()
    // UIæ¸²æŸ“
}
```

#### ä¾èµ–æ³¨å…¥ - Koin
- **ç‰ˆæœ¬**: 4.1.1
- **æ¨¡å—åˆ’åˆ†**:
  - `appModule` - åº”ç”¨çº§ä¾èµ–
  - `dataModule` - æ•°æ®å±‚ä¾èµ–
  - `roomModule` - æ•°æ®åº“ä¾èµ–
  - `viewModelModule` - ViewModelä¾èµ–

```kotlin
val appModule = module {
    single { HttpClientFactory.client }
    single { AuthApi(get()) }
    // ...
}

val viewModelModule = module {
    viewModel { HomeViewModel(get()) }
    // ...
}
```

#### å¯¼èˆª - Navigation Compose
- **ç‰ˆæœ¬**: 2.9.5
- **è·¯ç”±å®šä¹‰**: ä½¿ç”¨ Kotlin Serialization
```kotlin
@Serializable
sealed class AppRoute {
    @Serializable
    data object MainNav : AppRoute()
    
    @Serializable
    data class Play(val bvid: String) : AppRoute()
}
```

---

### 3. ç½‘ç»œå±‚æŠ€æœ¯

#### Ktor Client
- **ç‰ˆæœ¬**: 3.3.1
- **å¼•æ“**: OkHttp
- **åŠŸèƒ½**:
  - HTTPè¯·æ±‚
  - JSONåºåˆ—åŒ–/ååºåˆ—åŒ–
  - Cookieç®¡ç†
  - æ‹¦æˆªå™¨

```kotlin
val httpClient = HttpClient(OkHttp) {
    install(ContentNegotiation) {
        json(Json {
            ignoreUnknownKeys = true
            isLenient = true
        })
    }
    install(HttpCookies)
    // ...
}
```

#### APIè®¾è®¡
```kotlin
interface VideoApi {
    suspend fun getVideoDetail(
        bvid: String,
        cookie: String?
    ): BiliResponse<VideoDetailModel>
}

class VideoApiImpl(
    private val client: HttpClient
) : VideoApi {
    override suspend fun getVideoDetail(...) = 
        client.get("https://api.bilibili.com/x/web-interface/view") {
            parameter("bvid", bvid)
            // ...
        }
}
```

#### WBIç­¾åç³»ç»Ÿ
- **ç”¨é€”**: Bç«™APIè¯·æ±‚ç­¾å
- **æµç¨‹**:
  1. è·å– img_key å’Œ sub_key
  2. æ‹¼æ¥å¹¶æ··æ·†
  3. å¯¹è¯·æ±‚å‚æ•°è¿›è¡Œç­¾å

```kotlin
object WbiParams {
    fun signParams(params: Map<String, String>): Map<String, String> {
        // ç­¾åé€»è¾‘
    }
}
```

---

### 4. æ•°æ®å±‚æŠ€æœ¯

#### Roomæ•°æ®åº“
- **ç‰ˆæœ¬**: 2.8.2
- **å®ä½“**:
  - `SearchHistory` - æœç´¢å†å²
  - `DownloadTask` - ä¸‹è½½ä»»åŠ¡
  - `BiliSharedSource` - å…±äº«èµ„æº

```kotlin
@Database(
    entities = [
        SearchHistory::class,
        DownloadTask::class,
        BiliSharedSource::class
    ],
    version = 1
)
abstract class BiliTubeDB : RoomDatabase() {
    abstract fun searchHistoryDao(): SearchHistoryDao
    abstract fun downloadTaskDao(): DownloadTaskDao
    abstract fun biliSharedSourceDao(): BiliSharedSourceDao
}
```

#### DataStore
- **ç‰ˆæœ¬**: 1.1.7
- **ç±»å‹**: Preferences DataStore
- **å­˜å‚¨å†…å®¹**:
  - Cookieä¿¡æ¯
  - ç”¨æˆ·ä¿¡æ¯
  - åº”ç”¨è®¾ç½®
  - WBIå¯†é’¥

```kotlin
val COOKIE_KEY = stringPreferencesKey("cookie")
val IS_LOGIN_KEY = booleanPreferencesKey("is_login")
val USERNAME_KEY = stringPreferencesKey("username")
// ...

val Context.dataStore: DataStore<Preferences> by preferencesDataStore(
    name = "bili_tube_prefs"
)
```

#### SharedPreferences
- **ç”¨é€”**: ç®€å•é…ç½®å­˜å‚¨
- **å°è£…**: `PreferencesUtil`

---

### 5. åˆ†é¡µæŠ€æœ¯

#### Paging 3
- **ç‰ˆæœ¬**: 3.3.6
- **ç”¨é€”**: åˆ—è¡¨åˆ†é¡µåŠ è½½
- **å®ç°**: PagingSource

```kotlin
class RecommendPaging(
    private val repository: BiliHomeRepository
) : PagingSource<Int, VideoItem>() {
    override suspend fun load(
        params: LoadParams<Int>
    ): LoadResult<Int, VideoItem> {
        val page = params.key ?: 1
        return try {
            val data = repository.getRecommend(page)
            LoadResult.Page(
                data = data,
                prevKey = if (page == 1) null else page - 1,
                nextKey = if (data.isEmpty()) null else page + 1
            )
        } catch (e: Exception) {
            LoadResult.Error(e)
        }
    }
}
```

---

### 6. å¤šåª’ä½“æŠ€æœ¯

#### Media3 (ExoPlayer)
- **ç‰ˆæœ¬**: 1.8.0
- **åŠŸèƒ½**:
  - è§†é¢‘æ’­æ”¾
  - HLS/DASHæ”¯æŒ
  - è‡ªå®šä¹‰æ•°æ®æº
  - æ’­æ”¾æ§åˆ¶

```kotlin
val player = ExoPlayer.Builder(context)
    .setMediaSourceFactory(
        DefaultMediaSourceFactory(context)
            .setDataSourceFactory(dataSourceFactory)
    )
    .build()
```

#### Coil 3
- **ç‰ˆæœ¬**: 3.3.0
- **åŠŸèƒ½**: å›¾ç‰‡åŠ è½½
- **ç‰¹æ€§**:
  - å†…å­˜ç¼“å­˜
  - ç£ç›˜ç¼“å­˜
  - åç¨‹æ”¯æŒ
  - Composeé›†æˆ

```kotlin
AsyncImage(
    model = imageUrl,
    contentDescription = null,
    modifier = Modifier.size(120.dp)
)
```

#### FFmpeg
- **åº“**: Jellyfin Media3 FFmpeg Decoder
- **ç‰ˆæœ¬**: 1.8.0+1
- **ç”¨é€”**: æ‰©å±•è§£ç å™¨æ”¯æŒ

---

### 7. å…¶ä»–æŠ€æœ¯

#### Kotlin Serialization
- **ç‰ˆæœ¬**: 1.9.0
- **ç”¨é€”**: JSONåºåˆ—åŒ–/ååºåˆ—åŒ–
- **æ³¨è§£**:
  - `@Serializable` - å¯åºåˆ—åŒ–æ ‡è®°
  - `@SerialName` - å­—æ®µåæ˜ å°„

```kotlin
@Serializable
data class VideoDetailModel(
    @SerialName("bvid")
    val bvid: String,
    @SerialName("title")
    val title: String,
    // ...
)
```

#### ZXing
- **ç‰ˆæœ¬**: 3.5.3
- **ç”¨é€”**: äºŒç»´ç ç”Ÿæˆå’Œæ‰«æ
- **åº”ç”¨**: ç™»å½•äºŒç»´ç 

#### Conscrypt
- **ç‰ˆæœ¬**: 2.5.3
- **ç”¨é€”**: TLS/SSLåŠ å¯†æ”¯æŒ
- **ä½œç”¨**: æå‡HTTPSæ€§èƒ½

---

## ğŸ—‚ï¸ é¡¹ç›®ç»“æ„

### appæ¨¡å—ç»“æ„
```
app/src/main/java/com/laohei/bili_tube/
â”œâ”€â”€ core/                          # æ ¸å¿ƒå·¥å…·
â”‚   â”œâ”€â”€ action/                   # ç”¨æˆ·æ“ä½œ
â”‚   â”œâ”€â”€ correspondence/           # äº‹ä»¶æ€»çº¿
â”‚   â”œâ”€â”€ crash/                    # å´©æºƒå¤„ç†
â”‚   â”œâ”€â”€ extension/                # æ‰©å±•å‡½æ•°
â”‚   â”œâ”€â”€ runtime/                  # è¿è¡Œæ—¶å·¥å…·
â”‚   â””â”€â”€ Constants.kt              # å¸¸é‡å®šä¹‰
â”‚
â”œâ”€â”€ data/                          # æ•°æ®å±‚
â”‚   â”œâ”€â”€ local/                    # æœ¬åœ°å­˜å‚¨
â”‚   â”‚   â”œâ”€â”€ datastore/           # DataStore
â”‚   â”‚   â”œâ”€â”€ prefs/               # SharedPreferences
â”‚   â”‚   â””â”€â”€ room/                # Roomæ•°æ®åº“
â”‚   â”œâ”€â”€ paging/                   # åˆ†é¡µæ•°æ®æº
â”‚   â”œâ”€â”€ repository/               # ä»“åº“å±‚
â”‚   â””â”€â”€ PlayerDataSourceFactory.kt
â”‚
â”œâ”€â”€ di/                            # ä¾èµ–æ³¨å…¥
â”‚   â”œâ”€â”€ AppModule.kt
â”‚   â”œâ”€â”€ DataModule.kt
â”‚   â”œâ”€â”€ RoomModule.kt
â”‚   â””â”€â”€ ViewModelModule.kt
â”‚
â”œâ”€â”€ features/                      # åŠŸèƒ½æ¨¡å—
â”‚   â”œâ”€â”€ splash/                   # å¯åŠ¨é¡µ
â”‚   â”œâ”€â”€ login/                    # ç™»å½•
â”‚   â”œâ”€â”€ main/                     # ä¸»é¡µ
â”‚   â”‚   â”œâ”€â”€ home/                # é¦–é¡µ
â”‚   â”‚   â”œâ”€â”€ subscription/        # è®¢é˜…
â”‚   â”‚   â””â”€â”€ profile/             # ä¸ªäººèµ„æ–™
â”‚   â”œâ”€â”€ player/                   # æ’­æ”¾å™¨
â”‚   â”œâ”€â”€ search/                   # æœç´¢
â”‚   â”œâ”€â”€ history/                  # å†å²è®°å½•
â”‚   â”œâ”€â”€ playlist/                 # æ’­æ”¾åˆ—è¡¨
â”‚   â”œâ”€â”€ download/                 # ä¸‹è½½
â”‚   â”œâ”€â”€ setting/                  # è®¾ç½®
â”‚   â””â”€â”€ image/                    # å›¾ç‰‡æµè§ˆ
â”‚
â”œâ”€â”€ model/                         # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ extension/                # æ¨¡å‹æ‰©å±•
â”‚   â””â”€â”€ play/                     # æ’­æ”¾ç›¸å…³æ¨¡å‹
â”‚
â”œâ”€â”€ nav/                           # å¯¼èˆª
â”‚   â”œâ”€â”€ AppNav.kt                 # å¯¼èˆªé…ç½®
â”‚   â””â”€â”€ AppRoute.kt               # è·¯ç”±å®šä¹‰
â”‚
â”œâ”€â”€ network/                       # ç½‘ç»œ
â”‚   â”œâ”€â”€ HttpClientFactory.kt      # HTTPå®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ NetworkUtil.kt            # ç½‘ç»œå·¥å…·
â”‚   â””â”€â”€ CacheManager.kt           # ç¼“å­˜ç®¡ç†
â”‚
â”œâ”€â”€ opengl/                        # OpenGLæ¸²æŸ“
â”‚   â”œâ”€â”€ glsl/                     # ç€è‰²å™¨
â”‚   â”œâ”€â”€ util/                     # å·¥å…·
â”‚   â””â”€â”€ view/                     # è§†å›¾
â”‚
â”œâ”€â”€ ui/                            # UIç»„ä»¶
â”‚   â”œâ”€â”€ theme/                    # ä¸»é¢˜
â”‚   â”œâ”€â”€ component/                # é€šç”¨ç»„ä»¶
â”‚   â””â”€â”€ viewmodel/                # å…±äº«ViewModel
â”‚
â”œâ”€â”€ util/                          # å·¥å…·ç±»
â”‚
â”œâ”€â”€ AppState.kt                    # åº”ç”¨çŠ¶æ€
â”œâ”€â”€ BiliTubeApp.kt                # Application
â””â”€â”€ MainActivity.kt                # ä¸»Activity
```

### bili_sdkæ¨¡å—ç»“æ„
```
bili_sdk/src/main/java/com/laohei/bili_sdk/
â”œâ”€â”€ apis/                          # APIæ¥å£
â”‚   â”œâ”€â”€ impl/                     # APIå®ç°
â”‚   â”œâ”€â”€ Apis.kt                   # APIå·¥å‚
â”‚   â”œâ”€â”€ AuthApi.kt                # è®¤è¯API
â”‚   â”œâ”€â”€ UserApi.kt                # ç”¨æˆ·API
â”‚   â”œâ”€â”€ VideoApi.kt               # è§†é¢‘API
â”‚   â”œâ”€â”€ PlayApi.kt                # æ’­æ”¾API
â”‚   â”œâ”€â”€ BangumiApi.kt             # ç•ªå‰§API
â”‚   â”œâ”€â”€ HistoryApi.kt             # å†å²API
â”‚   â”œâ”€â”€ FolderApi.kt              # æ”¶è—å¤¹API
â”‚   â””â”€â”€ InternationalizationApi.kt # å›½é™…åŒ–API
â”‚
â”œâ”€â”€ model/                         # æ—§æ•°æ®æ¨¡å‹ï¼ˆAIç”Ÿæˆï¼‰
â”œâ”€â”€ model_v2/                      # æ–°æ•°æ®æ¨¡å‹ï¼ˆä¼˜åŒ–åï¼‰
â”‚   â”œâ”€â”€ common/                   # é€šç”¨æ¨¡å‹
â”‚   â”œâ”€â”€ video/                    # è§†é¢‘æ¨¡å‹
â”‚   â”œâ”€â”€ user/                     # ç”¨æˆ·æ¨¡å‹
â”‚   â”œâ”€â”€ bangumi/                  # ç•ªå‰§æ¨¡å‹
â”‚   â”œâ”€â”€ dynamic/                  # åŠ¨æ€æ¨¡å‹
â”‚   â”œâ”€â”€ reply/                    # è¯„è®ºæ¨¡å‹
â”‚   â”œâ”€â”€ search/                   # æœç´¢æ¨¡å‹
â”‚   â”œâ”€â”€ hot/                      # çƒ­é—¨æ¨¡å‹
â”‚   â”œâ”€â”€ history/                  # å†å²æ¨¡å‹
â”‚   â”œâ”€â”€ folder/                   # æ”¶è—å¤¹æ¨¡å‹
â”‚   â”œâ”€â”€ login/                    # ç™»å½•æ¨¡å‹
â”‚   â”œâ”€â”€ location/                 # åœ°ç†ä½ç½®æ¨¡å‹
â”‚   â””â”€â”€ captcha/                  # éªŒè¯ç æ¨¡å‹
â”‚
â”œâ”€â”€ wbi/                           # WBIç­¾å
â”‚   â”œâ”€â”€ GetWbi.kt                 # è·å–WBI
â”‚   â”œâ”€â”€ WbiParams.kt              # WBIå‚æ•°
â”‚   â””â”€â”€ Extensions.kt             # WBIæ‰©å±•
â”‚
â”œâ”€â”€ search/                        # æœç´¢
â”‚   â””â”€â”€ SearchRequest.kt          # æœç´¢è¯·æ±‚
â”‚
â””â”€â”€ exception/                     # å¼‚å¸¸å¤„ç†
    â””â”€â”€ globalSDKExceptionHandle.kt
```

---

## ğŸ”„ æ•°æ®æµ

### 1. è§†é¢‘åˆ—è¡¨åŠ è½½æµç¨‹
```
Screen (UI)
    â†“ collectAsLazyPagingItems()
ViewModel
    â†“ Pager(config, pagingSource)
PagingSource
    â†“ load(page)
Repository
    â†“ getVideos(page)
API
    â†“ HTTP Request
Bilibili Server
    â†“ JSON Response
Model (Data)
    â†‘ åå‘æµåŠ¨
    â†‘ çŠ¶æ€æ›´æ–°
    â†‘ UIæ¸²æŸ“
```

### 2. ç™»å½•æµç¨‹
```
LoginScreen
    â†“ æ‰«ç /è¾“å…¥
LoginViewModel
    â†“ login()
BiliLoginRepository
    â†“ qrcode / sms / password
AuthApi
    â†“ HTTP Request
Bilibili Auth Server
    â†“ Login Response
    â†“ Save Cookie
DataStore
    â†“ Update IS_LOGIN_KEY
MainActivity
    â†“ ObserveLoginState
    â†“ Navigate to MainNav
MainScreen (å·²ç™»å½•)
```

### 3. è§†é¢‘æ’­æ”¾æµç¨‹
```
VideoCard
    â†“ onClick(bvid)
Navigation
    â†“ navigate(AppRoute.Play)
VideoScreen
    â†“ Load Video Info
MediaViewModel
    â†“ getVideoDetail(bvid)
    â†“ getVideoURL(bvid, cid)
BiliPlayRepository
    â†“ API Requests
VideoApi + PlayApi
    â†“ Video Info + Play URL
ExoPlayer
    â†“ setMediaSource()
    â†“ prepare()
    â†“ play()
Video Playing
```

---

## ğŸ¨ UIè®¾è®¡æ¨¡å¼

### 1. ç»„åˆä¼˜äºç»§æ‰¿
```kotlin
// ä¸ä½¿ç”¨ç»§æ‰¿ï¼Œä½¿ç”¨ç»„åˆ
@Composable
fun VideoCard(
    video: VideoModel,
    onClick: () -> Unit
) {
    Card(onClick = onClick) {
        Column {
            VideoThumbnail(video.cover)
            VideoInfo(video)
            AuthorInfo(video.author)
        }
    }
}
```

### 2. çŠ¶æ€æå‡
```kotlin
@Composable
fun ParentScreen() {
    var selectedTab by remember { mutableStateOf(0) }
    
    Column {
        TabRow(selectedTab) { /* tabs */ }
        TabContent(selectedTab) { tab ->
            selectedTab = tab  // çŠ¶æ€æå‡åˆ°çˆ¶ç»„ä»¶
        }
    }
}
```

### 3. å•å‘æ•°æ®æµ
```
User Action â†’ ViewModel.action()
                 â†“
            Update UIState
                 â†“
            StateFlow.emit()
                 â†“
            UI Re-compose
```

---

## ğŸ” å®‰å…¨ç­–ç•¥

### 1. Cookieç®¡ç†
- ä½¿ç”¨ DataStore åŠ å¯†å­˜å‚¨
- ä¸åœ¨æ—¥å¿—ä¸­è¾“å‡ºæ•æ„Ÿä¿¡æ¯
- åŠæ—¶æ¸…ç†è¿‡æœŸCookie

### 2. æƒé™ç®¡ç†
- è¿è¡Œæ—¶æƒé™è¯·æ±‚
- æƒé™æœ€å°åŒ–åŸåˆ™
- æƒé™ä½¿ç”¨è¯´æ˜

### 3. æ•°æ®åŠ å¯†
- HTTPSé€šä¿¡
- æœ¬åœ°æ•°æ®åŠ å¯†ï¼ˆConscryptï¼‰
- æ•æ„Ÿä¿¡æ¯è„±æ•

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### 1. åˆ—è¡¨æ€§èƒ½
- ä½¿ç”¨ `LazyColumn` æ‡’åŠ è½½
- å®ç°åˆ†é¡µåŠ è½½
- ä½¿ç”¨ `key` ä¼˜åŒ–é‡ç»„
- é¿å…åµŒå¥—æ»šåŠ¨

### 2. å›¾ç‰‡åŠ è½½
- Coil å†…å­˜/ç£ç›˜ç¼“å­˜
- å›¾ç‰‡å°ºå¯¸ä¼˜åŒ–
- å ä½ç¬¦å’Œé”™è¯¯å›¾
- æ¸è¿›å¼åŠ è½½

### 3. è§†é¢‘æ’­æ”¾
- é¢„åŠ è½½ç­–ç•¥
- ç¼“å†²åŒºç®¡ç†
- æ¸…æ™°åº¦è‡ªé€‚åº”
- èµ„æºåŠæ—¶é‡Šæ”¾

### 4. å†…å­˜ç®¡ç†
- åŠæ—¶é‡Šæ”¾èµ„æº
- é¿å…å†…å­˜æ³„æ¼
- ä½¿ç”¨ `remember` æ­£ç¡®ç¼“å­˜
- ç›‘æ§å†…å­˜ä½¿ç”¨

---

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### 1. å•å…ƒæµ‹è¯•
- Repository æµ‹è¯•
- ViewModel æµ‹è¯•
- Utils å·¥å…·ç±»æµ‹è¯•

### 2. UIæµ‹è¯•
- Compose UIæµ‹è¯•
- å¯¼èˆªæµ‹è¯•
- ç”¨æˆ·äº¤äº’æµ‹è¯•

### 3. é›†æˆæµ‹è¯•
- APIé›†æˆæµ‹è¯•
- æ•°æ®åº“æµ‹è¯•
- ç«¯åˆ°ç«¯æµ‹è¯•

---

## ğŸ“– å‚è€ƒèµ„æº

- [Jetpack Composeæ–‡æ¡£](https://developer.android.com/jetpack/compose)
- [Ktoræ–‡æ¡£](https://ktor.io/)
- [Media3æ–‡æ¡£](https://developer.android.com/media/media3)
- [Koinæ–‡æ¡£](https://insert-koin.io/)
- [Roomæ–‡æ¡£](https://developer.android.com/training/data-storage/room)

---

**æœ€åæ›´æ–°**: 2026-02-04  
**æ–‡æ¡£ç‰ˆæœ¬**: v1.0.0
