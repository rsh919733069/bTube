# bTube 项目复刻计划

> 基于 bili_tube 开源项目的复刻与改进计划

## 📋 项目概述

**源项目**: bili_tube - 学习 B站 和 YouTube 客户端 UI 的 Android 项目  
**目标项目**: bTube - 在复刻基础上进行优化和完善  
**开发语言**: Kotlin  
**UI框架**: Jetpack Compose + Material 3

---

## 🔧 技术栈分析

### 核心技术
- **UI框架**: Jetpack Compose + Material 3
- **架构模式**: MVVM + Repository Pattern
- **依赖注入**: Koin
- **网络请求**: Ktor Client
- **数据存储**: Room + DataStore + SharedPreferences
- **图片加载**: Coil 3
- **视频播放**: Media3 (ExoPlayer)
- **导航**: Navigation Compose
- **分页**: Paging 3
- **序列化**: Kotlin Serialization
- **动画**: Lottie
- **二维码**: ZXing
- **多媒体处理**: FFmpeg

### 模块结构
```
bili_tube/
├── app/                          # 主应用模块
├── bili_sdk/                     # B站SDK（API + 数据模型）
├── common_ui_core/               # 通用UI组件
└── feature_annotations/          # 特性注解
```

---

## 📊 功能模块分析

### 1. 启动模块
- **文件**: `splash/SplashScreen.kt`
- **功能**: 应用启动页

### 2. 登录模块
- **文件**: 
  - `login/QRCodeLoginScreen.kt` - 二维码登录
  - `login/SMSLoginScreen.kt` - 短信验证码登录
  - `login/PasswordLoginScreen.kt` - 密码登录
- **组件**: 
  - 登录按钮、验证码输入、手机号输入等
- **API**: 
  - 获取二维码、检查登录状态、发送验证码、登录验证

### 3. 主页模块
- **文件**:
  - `main/home/HomeScreen.kt` - 主页容器
  - `main/home/recommend/RecommendScreen.kt` - 推荐页
  - `main/home/hot/HotScreen.kt` - 热门页
  - `main/home/anime/BangumiScreen.kt` - 番剧页
  - `main/home/anime/AnimationScreen.kt` - 动画页
- **功能**: 
  - 视频推荐流
  - 热门视频
  - 番剧/动画内容

### 4. 订阅模块
- **文件**: `main/subscription/SubscriptionScreen.kt`
- **功能**: 用户订阅的UP主动态

### 5. 个人资料模块
- **文件**: `main/profile/ProfileScreen.kt`
- **功能**: 
  - 用户信息展示
  - 收藏夹
  - 历史记录入口

### 6. 视频播放器模块
- **文件**: `player/VideoScreen.kt`
- **功能**: 
  - 视频播放控制
  - 弹幕显示
  - 视频信息展示
  - 评论区
  - 推荐相关视频

### 7. 搜索模块
- **文件**: `search/SearchScreen.kt`
- **功能**: 
  - 搜索历史
  - 搜索建议
  - 搜索结果展示

### 8. 历史记录模块
- **文件**: `history/HistoryScreen.kt`
- **功能**: 
  - 观看历史
  - 历史管理

### 9. 播放列表模块
- **文件**: 
  - `playlist/PlaylistScreen.kt` - 播放列表
  - `playlist/PlaylistContentScreen.kt` - 播放列表内容

### 10. 下载模块
- **文件**: `download/DownloadScreen.kt`
- **功能**: 
  - 下载管理
  - 离线观看

### 11. 设置模块
- **文件**:
  - `setting/MainSettingScreen.kt` - 主设置页
  - `setting/PlaySettingScreen.kt` - 播放设置
  - `setting/VideoSettingScreen.kt` - 视频设置
  - `setting/AudioSettingScreen.kt` - 音频设置

---

## 🚀 分阶段复刻计划

### ✅ 阶段 0: 项目初始化（已完成）
- [x] 创建 bTube 项目
- [x] 分析 bili_tube 项目结构
- [x] 制定复刻计划文档

### 📝 阶段 1: 基础架构搭建
**预计工作量**: 中等  
**状态**: ⏳ 待开始

#### 任务清单
- [ ] 1.1 配置项目依赖
  - [ ] 复制并调整 `gradle/libs.versions.toml`
  - [ ] 配置 `build.gradle.kts`（根项目和app模块）
  - [ ] 设置 `settings.gradle.kts`
  
- [ ] 1.2 创建基础模块结构
  - [ ] 创建 `bili_sdk` 模块
  - [ ] 创建 `common_ui_core` 模块
  - [ ] 创建 `feature_annotations` 模块
  
- [ ] 1.3 初始化应用核心
  - [ ] 创建 `BiliTubeApp.kt` 应用类
  - [ ] 配置 Koin 依赖注入
  - [ ] 设置 AndroidManifest.xml
  
- [ ] 1.4 建立核心工具类
  - [ ] 网络请求工具 (`HttpClientFactory.kt`)
  - [ ] 数据存储工具 (`DataStore`, `PreferencesUtil`)
  - [ ] 扩展函数集合 (`extension/`)
  - [ ] 常量定义 (`Constants.kt`)

**改进点**:
- ✨ 使用最新版本的依赖库
- ✨ 添加更完善的异常处理机制
- ✨ 优化模块间依赖关系

---

### 📝 阶段 2: SDK 模块开发
**预计工作量**: 大  
**状态**: ⏳ 待开始

#### 任务清单
- [ ] 2.1 数据模型层
  - [ ] 复制并优化 `model_v2/` 数据模型
  - [ ] 实现数据模型的序列化
  - [ ] 添加数据验证逻辑
  
- [ ] 2.2 API 接口层
  - [ ] `AuthApi` - 认证相关API
  - [ ] `UserApi` - 用户信息API
  - [ ] `VideoApi` - 视频信息API
  - [ ] `PlayApi` - 播放相关API
  - [ ] `BangumiApi` - 番剧API
  - [ ] `HistoryApi` - 历史记录API
  - [ ] `FolderApi` - 收藏夹API
  - [ ] `InternationalizationApi` - 国际化API
  
- [ ] 2.3 WBI 签名系统
  - [ ] `GetWbi.kt` - WBI获取
  - [ ] `WbiParams.kt` - WBI参数
  - [ ] `Extensions.kt` - WBI扩展函数
  
- [ ] 2.4 搜索模块
  - [ ] `SearchRequest.kt` - 搜索请求

**改进点**:
- ✨ 统一 API 响应处理
- ✨ 添加请求重试机制
- ✨ 优化错误提示信息
- ✨ 实现 API 请求缓存
- ✨ 添加接口文档注释

---

### 📝 阶段 3: 数据层开发
**预计工作量**: 中等  
**状态**: ⏳ 待开始

#### 任务清单
- [ ] 3.1 Room 数据库
  - [ ] `BiliTubeDB.kt` - 数据库定义
  - [ ] `dao/` - DAO层
    - [ ] `SearchHistoryDao` - 搜索历史
    - [ ] `DownloadTaskDao` - 下载任务
    - [ ] `BiliSharedSourceDao` - 共享资源
  - [ ] `entity/` - 实体类
  - [ ] `converter/` - 类型转换器
  
- [ ] 3.2 Repository 层
  - [ ] `BiliHomeRepository` - 主页数据
  - [ ] `BiliLoginRepository` - 登录数据
  - [ ] `BiliPlayRepository` - 播放数据
  - [ ] `BiliProfileRepository` - 个人资料
  - [ ] `BiliSearchRepository` - 搜索数据
  - [ ] `BiliSubscriptionRepository` - 订阅数据
  - [ ] `BiliHistoryRepository` - 历史记录
  - [ ] `BiliPlaylistRepository` - 播放列表
  - [ ] `SearchHistoryRepository` - 搜索历史
  
- [ ] 3.3 Paging 分页
  - [ ] `RecommendPaging` - 推荐分页
  - [ ] `HotPaging` - 热门分页
  - [ ] `BangumiPaging` - 番剧分页
  - [ ] `SubscriptionPaging` - 订阅分页
  - [ ] `SearchPaging` - 搜索分页
  - [ ] `HistoryPaging` - 历史分页
  - [ ] `UserUploadedVideoPaging` - 用户投稿分页
  - [ ] `VideoReplyPaging` - 视频评论分页
  - [ ] `FolderResourcePaging` - 收藏夹分页
  - [ ] `TimelinePaging` - 时间线分页

**改进点**:
- ✨ 优化数据库查询性能
- ✨ 添加数据库迁移策略
- ✨ 实现数据同步机制
- ✨ 优化分页加载逻辑

---

### ✅ 阶段 4: UI 基础组件（已完成）
**预计工作量**: 中等  
**状态**: ✅ 已完成

#### 任务清单
- [x] 4.1 主题系统
  - [x] `ui/theme/Color.kt` - 颜色定义
  - [x] `ui/theme/Theme.kt` - 主题配置
  - [x] `ui/theme/Type.kt` - 字体排版
  
- [x] 4.2 通用UI组件
  - [x] `common_ui_core/ActionButtonListItem.kt`
  - [x] `common_ui_core/NotchedBottomBar.kt`
  - [x] `ActionButton.kt` - 操作按钮
  
- [x] 4.3 导航系统
  - [x] `nav/AppRoute.kt` - 路由定义
  - [x] `nav/AppNav.kt` - 导航配置
  - [x] `AppState.kt` - 应用状态管理

**改进点**:
- ✨ 实现深色模式切换
- ✨ 支持动态主题色
- ✨ 优化组件复用性
- ✨ 添加更多 Material 3 特性

---

### ✅ 阶段 5: 启动与登录功能（已完成）
**预计工作量**: 中等  
**状态**: ✅ 已完成

#### 任务清单
- [x] 5.1 启动页
  - [x] `splash/SplashScreen.kt`
  - [x] 启动动画
  - [x] 初始化检查（Splash 后根据 isLogin 路由）
  
- [x] 5.2 登录功能
  - [x] `login/LoginViewModel.kt`
  - [x] `login/QRCodeLoginScreen.kt` - 二维码登录
  - [x] `login/SMSLoginScreen.kt` - 短信登录（占位）
  - [ ] `login/PasswordLoginScreen.kt` - 密码登录（待实现）
  - [x] 登录导航 (`login/LoginNav.kt`)
  - [x] `rememberQrBitmapPainter` - 二维码生成
  
- [x] 5.3 登录状态管理
  - [x] Cookie 存储（DataStore）
  - [x] 登录状态持久化
  - [x] 登录成功后自动跳转 MainNav

**改进点**:
- ✨ 优化二维码刷新机制
- ✨ 添加生物识别登录
- ✨ 改进错误提示
- ✨ 优化登录流程体验

---

### 📝 阶段 6: 主页功能
**预计工作量**: 大  
**状态**: ⏳ 待开始

#### 任务清单
- [ ] 6.1 主页框架
  - [ ] `main/MainScreen.kt` - 主页容器
  - [ ] `main/MainViewModel.kt`
  - [ ] 底部导航栏
  - [ ] 顶部导航栏
  
- [ ] 6.2 推荐页
  - [ ] `main/home/recommend/RecommendScreen.kt`
  - [ ] `main/home/recommend/RecommendViewModel.kt`
  - [ ] 视频卡片组件
  
- [ ] 6.3 热门页
  - [ ] `main/home/hot/HotScreen.kt`
  - [ ] `main/home/hot/HotViewModel.kt`
  - [ ] 热门视频列表
  
- [ ] 6.4 番剧页
  - [ ] `main/home/anime/BangumiScreen.kt`
  - [ ] `main/home/anime/AnimationScreen.kt`
  - [ ] `main/home/anime/BangumiViewModel.kt`
  - [ ] 番剧时间表
  
- [ ] 6.5 订阅页
  - [ ] `main/subscription/SubscriptionScreen.kt`
  - [ ] `main/subscription/SubscriptionViewModel.kt`
  - [ ] 动态卡片组件
  
- [ ] 6.6 个人资料页
  - [ ] `main/profile/ProfileScreen.kt`
  - [ ] `main/profile/ProfileViewModel.kt`
  - [ ] 用户信息展示
  - [ ] 收藏夹列表

**改进点**:
- ✨ 优化视频列表滚动性能
- ✨ 添加下拉刷新动画
- ✨ 改进视频卡片设计
- ✨ 实现自适应布局（平板优化）
- ✨ 添加骨架屏加载效果

---

### 📝 阶段 7: 视频播放器
**预计工作量**: 大  
**状态**: ⏳ 待开始

#### 任务清单
- [ ] 7.1 播放器核心
  - [ ] `player/VideoScreen.kt`
  - [ ] `player/MediaViewModel.kt`
  - [ ] `player/state/media/MediaController.kt`
  - [ ] `player/state/screen/ScreenController.kt`
  
- [ ] 7.2 播放器UI组件
  - [ ] 播放控制条
  - [ ] 进度条
  - [ ] 音量/亮度控制
  - [ ] 倍速选择
  - [ ] 清晰度选择
  - [ ] 弹幕开关
  - [ ] 全屏切换
  
- [ ] 7.3 视频信息
  - [ ] 视频标题、作者信息
  - [ ] 点赞、投币、收藏、分享
  - [ ] 视频简介
  - [ ] 评论区
  - [ ] 推荐视频
  
- [ ] 7.4 播放器设置
  - [ ] `setting/PlaySettingScreen.kt`
  - [ ] `setting/VideoSettingScreen.kt`
  - [ ] `setting/AudioSettingScreen.kt`

**改进点**:
- ✨ 优化播放器性能
- ✨ 添加手势控制（双击快进、音量亮度调节）
- ✨ 实现画中画模式
- ✨ 优化弹幕渲染性能
- ✨ 添加播放记忆功能
- ✨ 支持更多视频格式
- ✨ 改进缓冲策略

---

### 📝 阶段 8: 搜索功能
**预计工作量**: 中等  
**状态**: ⏳ 待开始

#### 任务清单
- [ ] 8.1 搜索页面
  - [ ] `search/SearchScreen.kt`
  - [ ] `search/SearchViewModel.kt`
  
- [ ] 8.2 搜索组件
  - [ ] `search/component/SearchTopBar.kt`
  - [ ] `search/component/SearchResultList.kt`
  - [ ] `search/component/BangumiItem.kt`
  
- [ ] 8.3 搜索功能
  - [ ] 搜索建议
  - [ ] 搜索历史
  - [ ] 搜索结果（视频、用户、番剧）

**改进点**:
- ✨ 优化搜索算法
- ✨ 添加搜索过滤选项
- ✨ 实现实时搜索建议
- ✨ 优化搜索结果展示

---

### 📝 阶段 9: 历史与播放列表
**预计工作量**: 中等  
**状态**: ⏳ 待开始

#### 任务清单
- [ ] 9.1 历史记录
  - [ ] `history/HistoryScreen.kt`
  - [ ] `history/HistoryViewModel.kt`
  - [ ] `history/component/HistoryDropMenu.kt`
  - [ ] 历史记录列表
  - [ ] 历史删除功能
  
- [ ] 9.2 播放列表
  - [ ] `playlist/PlaylistScreen.kt`
  - [ ] `playlist/PlaylistContentScreen.kt`
  - [ ] `playlist/PlaylistViewModel.kt`
  - [ ] 播放列表管理

**改进点**:
- ✨ 添加历史分类（今天、昨天、更早）
- ✨ 实现历史同步
- ✨ 优化播放列表编辑体验
- ✨ 添加批量操作功能

---

### 📝 阶段 10: 下载功能
**预计工作量**: 大  
**状态**: ⏳ 待开始

#### 任务清单
- [ ] 10.1 下载管理
  - [ ] `download/DownloadScreen.kt`
  - [ ] `download/DownloadViewModel.kt`
  - [ ] 下载任务管理
  
- [ ] 10.2 下载功能
  - [ ] 下载队列
  - [ ] 断点续传
  - [ ] 下载进度显示
  - [ ] 下载文件管理

**改进点**:
- ✨ 实现多线程下载
- ✨ 优化下载速度
- ✨ 添加下载限速选项
- ✨ 改进存储管理
- ✨ 支持批量下载

---

### 📝 阶段 11: 设置功能
**预计工作量**: 中等  
**状态**: ⏳ 待开始

#### 任务清单
- [ ] 11.1 设置页面
  - [ ] `setting/MainSettingScreen.kt`
  - [ ] `setting/SettingViewModel.kt`
  - [ ] `setting/SettingNav.kt`
  
- [ ] 11.2 各类设置
  - [ ] 通用设置
  - [ ] 播放设置（已在阶段7完成）
  - [ ] 视频设置（已在阶段7完成）
  - [ ] 音频设置（已在阶段7完成）
  - [ ] 隐私设置
  - [ ] 缓存管理
  - [ ] 关于页面

**改进点**:
- ✨ 优化设置界面布局
- ✨ 添加更多自定义选项
- ✨ 实现设置导入导出
- ✨ 添加设置搜索功能

---

### 📝 阶段 12: 其他功能
**预计工作量**: 中等  
**状态**: ⏳ 待开始

#### 任务清单
- [ ] 12.1 图片浏览
  - [ ] `image/ZoomableImagePagerScreen.kt`
  - [ ] 图片缩放、手势操作
  
- [ ] 12.2 崩溃处理
  - [ ] `core/crash/CrashHandler.kt`
  - [ ] 崩溃日志收集
  
- [ ] 12.3 事件总线
  - [ ] `core/correspondence/EventBus.kt`
  
- [ ] 12.4 OpenGL渲染
  - [ ] `opengl/` - 高斯模糊等特效

**改进点**:
- ✨ 优化图片加载性能
- ✨ 添加崩溃自动恢复
- ✨ 改进错误上报机制

---

### 📝 阶段 13: 测试与优化
**预计工作量**: 大  
**状态**: ⏳ 待开始

#### 任务清单
- [ ] 13.1 单元测试
  - [ ] Repository 层测试
  - [ ] ViewModel 层测试
  - [ ] Utils 工具类测试
  
- [ ] 13.2 UI测试
  - [ ] 关键页面UI测试
  - [ ] 导航流程测试
  
- [ ] 13.3 性能优化
  - [ ] 启动速度优化
  - [ ] 内存优化
  - [ ] 网络请求优化
  - [ ] 渲染性能优化
  
- [ ] 13.4 代码优化
  - [ ] 代码规范检查
  - [ ] 代码重构
  - [ ] 文档完善

---

### 📝 阶段 14: 打包发布
**预计工作量**: 小  
**状态**: ⏳ 待开始

#### 任务清单
- [ ] 14.1 发布准备
  - [ ] 版本号配置
  - [ ] 混淆配置
  - [ ] 签名配置
  
- [ ] 14.2 多渠道打包
  - [ ] Release版本构建
  - [ ] APK优化
  
- [ ] 14.3 文档完善
  - [ ] README.md
  - [ ] 使用说明
  - [ ] 更新日志

---

## 🎯 关键改进计划

### 1. 架构优化
- ✅ 使用最新版本依赖库
- ✅ 优化模块间依赖关系
- ✅ 实现更清晰的分层架构
- ✅ 添加统一的异常处理

### 2. 性能优化
- ✅ 优化列表滚动性能
- ✅ 实现智能图片加载
- ✅ 优化视频播放性能
- ✅ 减少内存占用
- ✅ 优化启动速度

### 3. 用户体验优化
- ✅ 改进UI设计细节
- ✅ 添加更流畅的动画
- ✅ 优化交互反馈
- ✅ 支持平板自适应布局
- ✅ 实现深色模式优化

### 4. 功能完善
- ✅ 添加更多播放器功能
- ✅ 实现更完整的下载功能
- ✅ 添加更多设置选项
- ✅ 实现数据同步功能
- ✅ 添加离线模式

### 5. 代码质量
- ✅ 添加完整的代码注释
- ✅ 编写单元测试
- ✅ 统一代码风格
- ✅ 重构冗余代码
- ✅ 优化命名规范

### 6. 安全性
- ✅ 加强数据加密
- ✅ 优化权限管理
- ✅ 防止数据泄露
- ✅ 添加安全检查

---

## 📌 注意事项

### 开发规范
1. **命名规范**: 遵循 Kotlin 官方命名规范
2. **注释规范**: 关键代码必须添加注释
3. **提交规范**: 使用语义化提交信息
4. **分支管理**: 功能开发使用 feature 分支

### 测试要求
1. 每个模块开发完成后进行自测
2. 关键功能添加单元测试
3. UI变更需要进行视觉回归测试

### 性能要求
1. 启动时间 < 2秒
2. 列表滚动保持 60fps
3. 内存占用 < 300MB（正常使用）
4. APK大小 < 50MB

---

## 📅 当前进度

### 当前阶段
**阶段 0: 项目初始化** ✅ 已完成

### 下一步计划
**阶段 1: 基础架构搭建** ⏳ 准备开始

### 最近更新
- 2026-02-04: 创建复刻计划文档
- 2026-02-04: 完成bili_tube项目分析

---

## 📖 参考资源

- [bili_tube 源项目](https://github.com/xxx/bili_tube)
- [bilibili-API-collect](https://github.com/SocialSisterYi/bilibili-API-collect)
- [Jetpack Compose 官方文档](https://developer.android.com/jetpack/compose)
- [Material 3 设计规范](https://m3.material.io/)
- [Kotlin 官方文档](https://kotlinlang.org/docs/home.html)

---

## 🔄 更新日志

### 2026-02-04
- ✅ 创建项目复刻计划
- ✅ 完成源项目分析
- ✅ 制定14个阶段的开发计划
- ✅ 明确每个阶段的任务清单和改进点

---

**最后更新时间**: 2026-02-04  
**文档版本**: v1.0.0  
**维护者**: [您的名字]
